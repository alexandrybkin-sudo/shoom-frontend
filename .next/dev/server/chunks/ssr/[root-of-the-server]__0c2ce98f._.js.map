{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/alexandrybkin/shoom/app/room/page.tsx"],"sourcesContent":["'use client';\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { io, Socket } from 'socket.io-client';\nimport { Play, SkipForward, RotateCcw, Heart, Send } from 'lucide-react';\nimport {\n  LiveKitRoom,\n  GridLayout,\n  ParticipantTile,\n  useTracks,\n  RoomAudioRenderer,\n} from '@livekit/components-react';\nimport '@livekit/components-styles';\nimport { Track } from 'livekit-client';\n\n// --- Types ---\ntype Phase = 'waiting' | 'intro' | 'roundA' | 'roundB' | 'ad' | 'voting' | 'rage' | 'finished';\ntype Role = 'viewer' | 'admin' | 'debater';\n\ninterface Message {\n  id: string;\n  user: string;\n  text: string;\n  isDonation: boolean;\n  amount?: number;\n}\n\ninterface FloatingEmoji {\n  id: number;\n  x: number;\n  emoji: string;\n}\n\ninterface ServerState {\n  phase: Phase;\n  timeLeft: number;\n  activePlayer: 'A' | 'B' | null;\n  viewersCount: number;\n  chatMessages: Message[];\n  donations: { user: string; amount: number }[];\n}\n\n// Helper component for video grid\nfunction VideoGrid() {\n  const tracks = useTracks([Track.Source.Camera]);\n  return (\n    <GridLayout tracks={tracks} className=\"h-full w-full\">\n      <ParticipantTile />\n    </GridLayout>\n  );\n}\n\nexport default function DebateRoom() {\n  // Local UI State\n  const [role, setRole] = useState<Role>('viewer');\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState('');\n  const [floatingEmojis, setFloatingEmojis] = useState<FloatingEmoji[]>([]);\n  const [token, setToken] = useState('');\n  \n  // Server State (Synced)\n  const [serverState, setServerState] = useState<ServerState>({\n    phase: 'waiting',\n    timeLeft: 0,\n    activePlayer: null,\n    viewersCount: 0,\n    chatMessages: [],\n    donations: []\n  });\n\n  const socketRef = useRef<Socket | null>(null);\n  const chatEndRef = useRef<HTMLDivElement>(null);\n\n  // --- Token Fetching ---\n  useEffect(() => {\n    const fetchToken = async () => {\n      try {\n        setToken(''); // Reset token to force re-connection\n        const participantName = `${role}-${Math.random().toString(36).substring(7)}`;\n        const lkRole = role === 'debater' ? 'debater' : 'viewer';\n        const res = await fetch(`http://localhost:4000/api/token?roomName=debate-room&participantName=${participantName}&role=${lkRole}`);\n        const data = await res.json();\n        setToken(data.token);\n      } catch (error) {\n        console.error('Error fetching token:', error);\n      }\n    };\n    fetchToken();\n  }, [role]);\n\n  // ... (WebSocket Connection logic remains the same)\n\n  const formatTime = (seconds: number) => {\n    const m = Math.floor(seconds / 60);\n    const s = seconds % 60;\n    return `${m}:${s < 10 ? '0' : ''}${s}`;\n  };\n\n  if (!token) return <div className=\"flex h-screen w-screen items-center justify-center bg-slate-950 text-white\">Loading...</div>;\n\n  return (\n    <div className=\"h-screen w-screen bg-slate-950 text-white font-sans overflow-hidden\">\n      <LiveKitRoom\n        video={role === 'debater'}\n        audio={role === 'debater'}\n        token={token}\n        serverUrl=\"wss://shoom-1bcua3f5.livekit.cloud\"\n        connect={true}\n        data-lk-theme=\"default\"\n        className=\"grid grid-cols-1 md:grid-cols-[1fr_350px] h-full w-full\"\n      >\n        {/* --- LEFT COLUMN: VIDEO AREA --- */}\n        <div className=\"relative flex flex-col h-full min-h-0 overflow-hidden bg-black\">\n          \n          {/* Floating Emojis (Overlay) */}\n          <div className=\"absolute inset-0 pointer-events-none z-50 overflow-hidden\">\n            {floatingEmojis.map(emoji => (\n              <div\n                key={emoji.id}\n                className=\"absolute text-4xl animate-float-up opacity-0\"\n                style={{ left: `${emoji.x}%`, bottom: '10%' }}\n              >\n                {emoji.emoji}\n              </div>\n            ))}\n          </div>\n\n          {/* Top Bar: Role Switcher & Timer (Desktop Layout) */}\n          <div className=\"absolute top-4 right-4 z-50 flex gap-1\">\n            {(['viewer', 'admin', 'debater'] as Role[]).map((r) => (\n              <button\n                key={r}\n                onClick={() => setRole(r)}\n                className={`px-3 py-1 text-[10px] uppercase font-bold rounded backdrop-blur-md transition-all ${\n                  role === r ? 'bg-blue-600 text-white' : 'bg-black/40 text-slate-400 hover:bg-black/60'\n                }`}\n              >\n                {r}\n              </button>\n            ))}\n          </div>\n\n          <div className=\"absolute top-6 left-1/2 -translate-x-1/2 z-40 pointer-events-none flex flex-col items-center\">\n             <div className={`text-4xl md:text-5xl font-black font-mono tabular-nums tracking-tighter drop-shadow-lg ${\n                serverState.timeLeft <= 10 && serverState.phase !== 'waiting' ? 'text-red-500 animate-pulse' : 'text-white'\n             }`}>\n               {formatTime(serverState.timeLeft)}\n             </div>\n             <div className=\"text-[10px] font-bold uppercase tracking-[0.3em] text-slate-400 drop-shadow-md bg-black/20 px-2 rounded\">\n               {serverState.phase === 'waiting' ? 'WAITING' : serverState.phase}\n             </div>\n          </div>\n\n          {/* Video Grid (Fills Left Column) */}\n          <div className=\"flex-1 relative w-full h-full\">\n             <VideoGrid />\n          </div>\n\n          {/* Viewer Count Badge */}\n          <div className=\"absolute top-4 left-4 z-40 bg-black/40 backdrop-blur-md px-3 py-1.5 rounded-full border border-white/5 flex items-center gap-2\">\n            <span className=\"w-2 h-2 bg-red-500 rounded-full animate-pulse\"/>\n            <span className=\"text-xs font-bold text-slate-200\">{serverState.viewersCount} watching</span>\n          </div>\n\n          {/* Admin Controls (Bottom Overlay) */}\n          {role === 'admin' && (\n            <div className=\"absolute bottom-8 left-1/2 -translate-x-1/2 z-50 flex gap-2 bg-black/80 p-2 rounded-xl backdrop-blur border border-white/10 shadow-2xl\">\n              <button onClick={() => sendAdminAction('start')} className=\"p-3 hover:bg-green-600 rounded-lg transition-colors text-white\"><Play size={20} /></button>\n              <button onClick={() => sendAdminAction('next_round')} className=\"p-3 hover:bg-blue-600 rounded-lg transition-colors text-white\"><SkipForward size={20} /></button>\n              <button onClick={() => sendAdminAction('reset')} className=\"p-3 hover:bg-red-600 rounded-lg transition-colors text-white\"><RotateCcw size={20} /></button>\n            </div>\n          )}\n\n          {/* Mobile Chat Overlay Gradient (Visible only on mobile) */}\n          <div className=\"md:hidden absolute bottom-0 left-0 right-0 h-1/2 bg-gradient-to-t from-black via-black/80 to-transparent pointer-events-none\" />\n        </div>\n\n        {/* --- RIGHT COLUMN: SIDEBAR (Desktop) / OVERLAY (Mobile) --- */}\n        <div className={`\n          flex flex-col h-full min-h-0 z-40\n          md:relative md:w-full md:bg-slate-950 md:border-l md:border-slate-800\n          absolute bottom-0 w-full h-[45vh] md:h-auto\n        `}>\n          \n          {/* Reaction Buttons (Floating on Right) */}\n          {role === 'viewer' && (\n            <div className=\"absolute -top-20 right-4 flex flex-col gap-3 md:static md:flex-row md:p-4 md:justify-center md:bg-slate-900/50 md:border-b md:border-slate-800\">\n              <button onClick={() => sendReaction('heart')} className=\"p-3 bg-slate-800/80 md:bg-slate-800 rounded-full text-2xl shadow-lg border border-white/10 active:scale-90 transition-transform hover:bg-pink-900/50\">‚ù§Ô∏è</button>\n              <button onClick={() => sendReaction('poop')} className=\"p-3 bg-slate-800/80 md:bg-slate-800 rounded-full text-2xl shadow-lg border border-white/10 active:scale-90 transition-transform hover:bg-yellow-900/50\">üí©</button>\n            </div>\n          )}\n\n          {/* Chat Messages */}\n          <div className=\"flex-1 overflow-y-auto px-4 py-2 space-y-3 scrollbar-thin scrollbar-thumb-slate-800 mask-image-top md:mask-none\">\n             {/* Desktop Donations Header */}\n             <div className=\"hidden md:block mb-4 p-3 bg-slate-900 rounded-lg border border-slate-800\">\n                <div className=\"flex justify-between items-center mb-2\">\n                  <span className=\"text-[10px] font-bold text-yellow-500 uppercase\">üèÜ Top Donators</span>\n                </div>\n                <div className=\"space-y-1 max-h-24 overflow-y-auto\">\n                  {serverState.donations.map((d, i) => (\n                    <div key={i} className=\"flex justify-between text-xs text-slate-400\">\n                      <span>{d.user}</span><span className=\"text-yellow-500\">{d.amount}‚ÇΩ</span>\n                    </div>\n                  ))}\n                </div>\n             </div>\n\n             {messages.map((msg, idx) => (\n               <div key={idx} className={`flex items-start gap-2 text-sm ${msg.isDonation ? 'bg-yellow-500/10 p-2 rounded-lg border border-yellow-500/20' : ''}`}>\n                 <span className={`font-bold whitespace-nowrap ${msg.user === 'Admin' ? 'text-red-400' : 'text-blue-400'}`}>{msg.user}:</span>\n                 <span className={`text-slate-200 break-words leading-snug ${msg.isDonation ? 'text-yellow-100 font-medium' : ''}`}>{msg.text}</span>\n               </div>\n             ))}\n             <div ref={chatEndRef} />\n          </div>\n\n          {/* Input Area */}\n          <div className=\"p-3 md:p-4 bg-transparent md:bg-slate-950 md:border-t md:border-slate-800\">\n            <form onSubmit={sendMessage} className=\"flex gap-2\">\n              <input \n                className=\"flex-1 bg-slate-800/80 md:bg-slate-900 border border-slate-700/50 rounded-full px-4 py-2.5 text-sm text-white focus:outline-none focus:border-blue-500 backdrop-blur-sm placeholder:text-slate-500 shadow-lg\"\n                placeholder=\"Send a message...\"\n                value={input}\n                onChange={e => setInput(e.target.value)}\n              />\n              {role === 'viewer' && (\n                <button type=\"button\" onClick={sendDonation} className=\"p-2.5 bg-yellow-600/20 text-yellow-500 rounded-full border border-yellow-600/50 active:scale-95 hover:bg-yellow-600/30 transition-colors\">\n                  üí∞\n                </button>\n              )}\n            </form>\n          </div>\n        </div>\n\n        <RoomAudioRenderer />\n        \n        <style jsx global>{`\n          @keyframes float-up {\n            0% { transform: translateY(0) scale(1); opacity: 1; }\n            100% { transform: translateY(-200px) scale(1.5); opacity: 0; }\n          }\n          .animate-float-up {\n            animation: float-up 2s ease-out forwards;\n          }\n          .mask-image-top {\n            mask-image: linear-gradient(to bottom, transparent 0%, black 15%);\n          }\n        `}</style>\n      </LiveKitRoom>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;;AAEA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAQA;AAbA;;;;;;;;AA0CA,kCAAkC;AAClC,SAAS;IACP,MAAM,SAAS,IAAA,6NAAS,EAAC;QAAC,+KAAK,CAAC,MAAM,CAAC,MAAM;KAAC;IAC9C,qBACE,8OAAC,oOAAU;QAAC,QAAQ;QAAQ,WAAU;kBACpC,cAAA,8OAAC,8OAAe;;;;;;;;;;AAGtB;AAEe,SAAS;IACtB,iBAAiB;IACjB,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAO;IACvC,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,iNAAQ,EAAY,EAAE;IACtD,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IACnC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,iNAAQ,EAAkB,EAAE;IACxE,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAC;IAEnC,wBAAwB;IACxB,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAc;QAC1D,OAAO;QACP,UAAU;QACV,cAAc;QACd,cAAc;QACd,cAAc,EAAE;QAChB,WAAW,EAAE;IACf;IAEA,MAAM,YAAY,IAAA,+MAAM,EAAgB;IACxC,MAAM,aAAa,IAAA,+MAAM,EAAiB;IAE1C,yBAAyB;IACzB,IAAA,kNAAS,EAAC;QACR,MAAM,aAAa;YACjB,IAAI;gBACF,SAAS,KAAK,qCAAqC;gBACnD,MAAM,kBAAkB,GAAG,KAAK,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,IAAI;gBAC5E,MAAM,SAAS,SAAS,YAAY,YAAY;gBAChD,MAAM,MAAM,MAAM,MAAM,CAAC,qEAAqE,EAAE,gBAAgB,MAAM,EAAE,QAAQ;gBAChI,MAAM,OAAO,MAAM,IAAI,IAAI;gBAC3B,SAAS,KAAK,KAAK;YACrB,EAAE,OAAO,OAAO;gBACd,QAAQ,KAAK,CAAC,yBAAyB;YACzC;QACF;QACA;IACF,GAAG;QAAC;KAAK;IAET,oDAAoD;IAEpD,MAAM,aAAa,CAAC;QAClB,MAAM,IAAI,KAAK,KAAK,CAAC,UAAU;QAC/B,MAAM,IAAI,UAAU;QACpB,OAAO,GAAG,EAAE,CAAC,EAAE,IAAI,KAAK,MAAM,KAAK,GAAG;IACxC;IAEA,IAAI,CAAC,OAAO,qBAAO,8OAAC;QAAI,WAAU;kBAA6E;;;;;;IAE/G,qBACE,8OAAC;QAAI,WAAU;kBACb,cAAA,8OAAC,gOAAW;YACV,OAAO,SAAS;YAChB,OAAO,SAAS;YAChB,OAAO;YACP,WAAU;YACV,SAAS;YACT,iBAAc;YACd,WAAU;;8BAGV,8OAAC;8DAAc;;sCAGb,8OAAC;sEAAc;sCACZ,eAAe,GAAG,CAAC,CAAA,sBAClB,8OAAC;oCAGC,OAAO;wCAAE,MAAM,GAAG,MAAM,CAAC,CAAC,CAAC,CAAC;wCAAE,QAAQ;oCAAM;8EADlC;8CAGT,MAAM,KAAK;mCAJP,MAAM,EAAE;;;;;;;;;;sCAUnB,8OAAC;sEAAc;sCACZ,AAAC;gCAAC;gCAAU;gCAAS;6BAAU,CAAY,GAAG,CAAC,CAAC,kBAC/C,8OAAC;oCAEC,SAAS,IAAM,QAAQ;8EACZ,CAAC,kFAAkF,EAC5F,SAAS,IAAI,2BAA2B,gDACxC;8CAED;mCANI;;;;;;;;;;sCAWX,8OAAC;sEAAc;;8CACZ,8OAAC;8EAAe,CAAC,uFAAuF,EACrG,YAAY,QAAQ,IAAI,MAAM,YAAY,KAAK,KAAK,YAAY,+BAA+B,cAChG;8CACC,WAAW,YAAY,QAAQ;;;;;;8CAElC,8OAAC;8EAAc;8CACZ,YAAY,KAAK,KAAK,YAAY,YAAY,YAAY,KAAK;;;;;;;;;;;;sCAKrE,8OAAC;sEAAc;sCACZ,cAAA,8OAAC;;;;;;;;;;sCAIJ,8OAAC;sEAAc;;8CACb,8OAAC;8EAAe;;;;;;8CAChB,8OAAC;8EAAe;;wCAAoC,YAAY,YAAY;wCAAC;;;;;;;;;;;;;wBAI9E,SAAS,yBACR,8OAAC;sEAAc;;8CACb,8OAAC;oCAAO,SAAS,IAAM,gBAAgB;8EAAoB;8CAAiE,cAAA,8OAAC,0MAAI;wCAAC,MAAM;;;;;;;;;;;8CACxI,8OAAC;oCAAO,SAAS,IAAM,gBAAgB;8EAAyB;8CAAgE,cAAA,8OAAC,mOAAW;wCAAC,MAAM;;;;;;;;;;;8CACnJ,8OAAC;oCAAO,SAAS,IAAM,gBAAgB;8EAAoB;8CAA+D,cAAA,8OAAC,6NAAS;wCAAC,MAAM;;;;;;;;;;;;;;;;;sCAK/I,8OAAC;sEAAc;;;;;;;;;;;;8BAIjB,8OAAC;8DAAe,CAAC;;;;QAIjB,CAAC;;wBAGE,SAAS,0BACR,8OAAC;sEAAc;;8CACb,8OAAC;oCAAO,SAAS,IAAM,aAAa;8EAAoB;8CAAuJ;;;;;;8CAC/M,8OAAC;oCAAO,SAAS,IAAM,aAAa;8EAAmB;8CAAyJ;;;;;;;;;;;;sCAKpN,8OAAC;sEAAc;;8CAEZ,8OAAC;8EAAc;;sDACZ,8OAAC;sFAAc;sDACb,cAAA,8OAAC;0FAAe;0DAAkD;;;;;;;;;;;sDAEpE,8OAAC;sFAAc;sDACZ,YAAY,SAAS,CAAC,GAAG,CAAC,CAAC,GAAG,kBAC7B,8OAAC;8FAAsB;;sEACrB,8OAAC;;sEAAM,EAAE,IAAI;;;;;;sEAAQ,8OAAC;sGAAe;;gEAAmB,EAAE,MAAM;gEAAC;;;;;;;;mDADzD;;;;;;;;;;;;;;;;gCAOhB,SAAS,GAAG,CAAC,CAAC,KAAK,oBAClB,8OAAC;kFAAyB,CAAC,+BAA+B,EAAE,IAAI,UAAU,GAAG,gEAAgE,IAAI;;0DAC/I,8OAAC;0FAAgB,CAAC,4BAA4B,EAAE,IAAI,IAAI,KAAK,UAAU,iBAAiB,iBAAiB;;oDAAG,IAAI,IAAI;oDAAC;;;;;;;0DACrH,8OAAC;0FAAgB,CAAC,wCAAwC,EAAE,IAAI,UAAU,GAAG,gCAAgC,IAAI;0DAAG,IAAI,IAAI;;;;;;;uCAFpH;;;;;8CAKZ,8OAAC;oCAAI,KAAK;;;;;;;;;;;;;sCAIb,8OAAC;sEAAc;sCACb,cAAA,8OAAC;gCAAK,UAAU;0EAAuB;;kDACrC,8OAAC;wCAEC,aAAY;wCACZ,OAAO;wCACP,UAAU,CAAA,IAAK,SAAS,EAAE,MAAM,CAAC,KAAK;kFAH5B;;;;;;oCAKX,SAAS,0BACR,8OAAC;wCAAO,MAAK;wCAAS,SAAS;kFAAwB;kDAA2I;;;;;;;;;;;;;;;;;;;;;;;8BAQ1M,8OAAC,kPAAiB;;;;;;;;;;;;;;;;;;;;AAiB1B"}}]
}